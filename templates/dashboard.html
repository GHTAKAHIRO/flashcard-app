{% extends "base.html" %}

{% block title %}ダッシュボード - フラッシュカードアプリ{% endblock %}

{% block content %}
<div class="mb-4">
    <h2 class="fw-bold">
        <i class="fas fa-tachometer-alt me-2"></i>ダッシュボード
    </h2>
    <p class="text-muted">こんにちは、{{ current_user.full_name }}さん！</p>
</div>

<!-- 学習システム選択 -->
<div class="row g-4 mb-5">
    <div class="col-12">
        <h3 class="h4 mb-3">
            <i class="fas fa-graduation-cap me-2"></i>学習システムを選択
        </h3>
    </div>
    
    <!-- フラッシュカード学習 -->
    <div class="col-md-6">
        <div class="card h-100 border-primary">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="fas fa-images fa-3x text-primary"></i>
                </div>
                <h5 class="card-title">フラッシュカード学習</h5>
                <p class="card-text">画像ベースのフラッシュカードで効率的に学習できます。</p>
                <a href="#flashcard-section" class="btn btn-primary">
                    <i class="fas fa-play me-1"></i>学習開始
                </a>
            </div>
        </div>
    </div>
    
    <!-- 社会科一問一答 -->
    <div class="col-md-6">
        <div class="card h-100 border-success">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="fas fa-globe-asia fa-3x text-success"></i>
                </div>
                <h5 class="card-title">社会科一問一答</h5>
                <p class="card-text">地理・歴史・公民の知識を入力形式で学習できます。</p>
                <a href="{{ url_for('social_studies_home') }}" class="btn btn-success">
                    <i class="fas fa-play me-1"></i>学習開始
                </a>
            </div>
        </div>
    </div>
</div>

<!-- フラッシュカード教材一覧 -->
<div id="flashcard-section" class="row g-4 mb-5">
    <div class="col-12">
        <h3 class="h4 mb-3">
            <i class="fas fa-images me-2"></i>フラッシュカード教材
        </h3>
    </div>
    
    {% for source in sources %}
    <div class="col-md-6 col-lg-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">{{ source.source }}</h5>
                <p class="card-text">
                    <small class="text-muted">
                        {{ source.subject }} {{ source.grade }}
                    </small>
                </p>
                
                <!-- 設定フォーム -->
                <form method="POST" action="{{ url_for('set_page_range_and_prepare', source=source.source) }}" class="mb-3">
                    <div class="mb-2">
                        <label for="page_range_{{ source.source }}" class="form-label small">ページ範囲</label>
                        <input type="text" class="form-control form-control-sm" 
                               id="page_range_{{ source.source }}" 
                               name="page_range" 
                               value="{{ saved_ranges.get(source.source, '') }}"
                               placeholder="例: 1-10, 15, 20-25"
                               {% if settings_locked.get(source.source, False) %}readonly{% endif %}>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label small">難易度</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="difficulty" value="basic" 
                                   id="basic_{{ source.source }}"
                                   {% if 'basic' in saved_difficulties.get(source.source, '').split(',') %}checked{% endif %}
                                   {% if settings_locked.get(source.source, False) %}disabled{% endif %}>
                            <label class="form-check-label small" for="basic_{{ source.source }}">基本</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="difficulty" value="intermediate" 
                                   id="intermediate_{{ source.source }}"
                                   {% if 'intermediate' in saved_difficulties.get(source.source, '').split(',') %}checked{% endif %}
                                   {% if settings_locked.get(source.source, False) %}disabled{% endif %}>
                            <label class="form-check-label small" for="intermediate_{{ source.source }}">中級</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="difficulty" value="advanced" 
                                   id="advanced_{{ source.source }}"
                                   {% if 'advanced' in saved_difficulties.get(source.source, '').split(',') %}checked{% endif %}
                                   {% if settings_locked.get(source.source, False) %}disabled{% endif %}>
                            <label class="form-check-label small" for="advanced_{{ source.source }}">上級</label>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-sm w-100">
                        <i class="fas fa-cog me-1"></i>設定して学習開始
                    </button>
                </form>
                
                {% if settings_locked.get(source.source, False) %}
                <div class="alert alert-warning alert-sm">
                    <i class="fas fa-lock me-1"></i>学習開始後は設定変更できません
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- 英単語学習セクション -->
<div class="row g-4 mb-5">
    <div class="col-12">
        <h3 class="h4 mb-3">
            <i class="fas fa-language me-2"></i>英単語学習
        </h3>
    </div>
    
    <div class="col-md-6">
        <div class="card h-100 border-info">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="fas fa-language fa-3x text-info"></i>
                </div>
                <h5 class="card-title">英単語学習</h5>
                <p class="card-text">基本単語からTOEIC、大学受験まで幅広く学習できます。</p>
                <a href="{{ url_for('vocabulary_home') }}" class="btn btn-info">
                    <i class="fas fa-play me-1"></i>学習開始
                </a>
            </div>
        </div>
    </div>
</div>

<!-- 管理者メニュー -->
{% if current_user.is_admin %}
<div class="row g-4 mb-5">
    <div class="col-12">
        <h3 class="h4 mb-3">
            <i class="fas fa-cog me-2"></i>管理者メニュー
        </h3>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-users-cog fa-2x text-warning mb-2"></i>
                <h6 class="card-title">システム管理</h6>
                <a href="{{ url_for('admin') }}" class="btn btn-warning btn-sm">
                    <i class="fas fa-cog me-1"></i>管理画面
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-globe-asia fa-2x text-success mb-2"></i>
                <h6 class="card-title">社会科管理</h6>
                <a href="{{ url_for('social_studies_admin') }}" class="btn btn-success btn-sm">
                    <i class="fas fa-cog me-1"></i>社会科管理
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-language fa-2x text-info mb-2"></i>
                <h6 class="card-title">英単語管理</h6>
                <a href="{{ url_for('vocabulary_admin') }}" class="btn btn-info btn-sm">
                    <i class="fas fa-cog me-1"></i>英単語管理
                </a>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}